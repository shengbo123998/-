1. 问题解析：
以往的方法只预估用户的观看时长的单点值，但是用户实际观看受很多因素影响，而且是一定有随机性的，因此我们想建模这种不确定性，具体来说我们的模型能够生成用户观看时长的分布，九个分位数。(最主要是从数据角度出发，模型预估的pcoc是比较准的，但是单看每条样本，其实是不准的，这就存在一个不确定性问题。)
然而，我们没有用户同一时间，观看同一个样本的多个时长，因此，我们利用Pinbal loss的不对称回归函数，来拟合用户观看时长的分布（pinball loss https://zhuanlan.zhihu.com/p/1890038842536473545 通过贝叶斯优化推导的，基于最优化理论，导数为0，预测的分位数值确实是对应的分位数）。
模型结构（MLP），模型训练，数据输入：
输入用户dense特征，笔记dense特征，精排模型打分：
heads = ['ClickRate', 'PageTime10Rate', 'FeedPageTime', 'PageTimeFirst', 'VideoCompleteRate', 'LikeRate', 'CollectRate', 'ShareRate', 'CommentRate', 'FollowRate', 'ClickProfileRate', 'ReadCommentRate', 'HideRate', 'ReadCommentFifteenthRate']
数据处理：视频观看时长label（这里我们试过 1500s截断，然后归一化，和做log(1+x)处理两种方案。效果差不多，归一化会更鲁棒一点，保留时长原本的分布，不然这个分位数就不是原来真正的分布啦）
模型最后预估长度为9的向量。如何保证分位数严格递增？这块目前是没有做操作，是使用了log(1+exp(x))激活函数。 后面打算换成relu， 然后每个分位数的输出就是前面分位数的累积求和，保证严格递增。
当然有其他一些目标，点击，有效点击，评论，D2Q, 作为辅助目标，共享embedding，模型不共享。
另外，有一个很重要的问题，我们做首页，有图文跟视频，图文也有pagetime，最开始是共享网络去做，后面拆分成两个网络，共享embedding，类似于兴趣迁移，AB效果有所提升。




解决方案
那么，有了这个分位数估计，我们怎么用？ 
首先，我们通过插值的方法，拟合用户观看时长均值，验证来该XAUC相比基线有所提升（视频0.71->0.72）（视频图文一起是0.72, 但是大精排没有视频图文首页时长一起的auc, 它的pagetime建模的视频时长是包括内流时长的）
第二，我们可以对用户分层使用。对于低活用户，不确定性强，用户流失程度高，
  ！实验踩过坑，第一个遇到的问题就是，视频图文曝光不平衡，主要是因为时长*ctr作为预估分。图文的ctr天然较高，而视频时长比图文高一点，但是高不多。因此，
第一个解决方案是，对图文视频分别调参，这样虽然能把视频曝光提起来，但是是局部解，不是全局最优解，导致图文跌更多。 
第二个解决方案是把ctr对指数调低（0.3），这样做整体效果都变差了，直接点击减少了，时长也就没有意义了。
目前的两个实验是： 1.只对视频生效 2.对用户进行分层，看看有没有涨
实验效果，以及怎么验证模型有效果
离线


label使用log(1+X)后的结果，pred跟label均值基本一致
avg_label
avg_pred
n
xauc
视频pagetime_first
2.686562396170235
2.687173902191842
160695
0.7187694005614937
首页视频图文
2.582019540139039
2.5644540339133908
754586
0.7215046677150696
label使用归一化之后，模型准度没那么高，（x2a/ltrVideoNoteQuan1是融合成均值后的结果），个人不是模型学的差，而是视频时长是长尾分布的，在高分位数的插值融合误差比较高。也可以看到下面，由于长尾分布，因此P50分位的中位数小于label均值，符合预期。 （label归一化效果更好，保留原本的分布，但是插值误差更大了，为什么最终效果可以更好？？ 不过看Auc, 两种label处理方式没有区别）
label使用归一化的结果
avg_label
avg_pred
n
regression_auc
x2a/ltrVideoNoteQuan1
0.01751135848530127
0.011094208064941552
841106
0.7200802906028277
x2a/ltrVideoNoteQuan2
0.01751135848530127
0.005149612069805018
841106
0.7037323235388975
x2a/ltrVideoNoteQuan3
0.01751135848530127
0.0075006510286001506
841106
0.7129793975654117
x2a/ltrVideoNoteQuan4
0.01751135848530127
0.010055233921272484
841106
0.7179399981799466
x2a/ltrVideoNoteQuan5
0.01751135848530127
0.012913305938836848
841106
0.720143163619946
x2a/ltrVideoNoteQuan6
0.01751135848530127
0.016209888398945303
841106
0.7202011109683693
x2a/ltrVideoNoteQuan7
0.01751135848530127
0.020247349242837342
841106
0.7181049719137381
x2a/ltrVideoNoteQuan8
0.01751135848530127
0.025750986172563214
841106
0.7135191882816754
x2a/ltrVideoNoteQuan9
0.01751135848530127
0.03518474660792754
841106
0.7050691549722972

人均总时长 +0.084%，视频时长 -0.017%，图文时长 +0.18811%
人均总阅读 +0.152%，视频阅读 +0.0047%，图文阅读 +0.453%
双列人均曝光 +0.0807%，视频曝光占比 -0.36%，视频ctr +0.264%，图文ctr +0.147%
人均总互动 -0.114%
vfau/dau -0.019%，is_fau_v2 -0.01%
总的来说（图文挤占了视频透出），视频曝光降低了，但是视频ctr跟图文ctr都上涨，视频时长持平，图文时长上涨。人均总互动跌了，所有实验桶都跌，不知道什么原因
